# pip install telebot
import time
import telebot
from telebot import types

bot = telebot.TeleBot('YOUR_BOT_TOKEN')

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–∏–∫–µ—Ä–∞ –≤ –ö–ë –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å—Ç–∏–∫–µ—Ä–∞
MAX_STICKER_SIZE = 230 * 1024
MAX_STICKER_RESOLUTION = (512, 512)

# –°–ª–æ–≤–∞—Ä–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –∏ –≥—Ä—É–ø–ø–∞—Ö
last_bot_messages_private = {}
last_bot_messages_group = {}

# –°–ª–æ–≤–∞—Ä–∏ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å—Ç–∏–∫–µ—Ä–æ–≤ –æ—Ç –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –∏ –≥—Ä—É–ø–ø–∞—Ö
deleted_sticker_count_private = {}
deleted_sticker_count_group = {}


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
@bot.message_handler(commands=['start'])
def handle_start(message):
    if message.chat.type == 'private':
        user_name = message.from_user.username
        bot.send_message(message.chat.id,
                         text=f"<b>–ü—Ä–∏–≤–µ—Ç, {user_name}</b>! üëã\n–≠—Ç–æ –±–æ—Ç <b>Anti Crash Sticker</b>. –û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –≥—Ä—É–ø–ø–∞—Ö –∏ —É–¥–∞–ª—è–µ—Ç <b>–∫—Ä–∞—à —Å—Ç–∏–∫–µ—Ä—ã</b>. –î–æ–±–∞–≤—å—Ç–µ –º–µ–Ω—è –≤ –≥—Ä—É–ø–ø—É, –∏ —è –Ω–∞—á–Ω—É —Å–≤–æ—é —Ä–∞–±–æ—Ç—É!",
                         parse_mode="HTML")
        markup = types.InlineKeyboardMarkup()
        button1 = types.InlineKeyboardButton(text='‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É ‚ûï', url='YOUR_BOT_INVITE_LINK')
        markup.add(button1)
        bot.send_message(message.chat.id, '<b>–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É</b>', reply_markup=markup,
                         parse_mode='HTML')
        time.sleep(0.5)
        bot.send_message(message.chat.id, "–ï—Å–ª–∏ –≤—ã —É–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É, –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ.")


# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞ –Ω–∞ –∫—Ä–∞—à –∏ —É–¥–∞–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–∞–∫–æ–π —Å—Ç–∏–∫–µ—Ä
@bot.message_handler(content_types=['sticker'])
def handle_sticker(message):
    sticker = message.sticker
    user_name = "@" + message.from_user.username

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –¥–ª—è —Å—Ç–∏–∫–µ—Ä–∞
    conditions_met = check_sticker_conditions(sticker)

    if conditions_met:
        if message.chat.type == 'private':
            last_bot_messages = last_bot_messages_private
            deleted_sticker_count = deleted_sticker_count_private
        else:
            last_bot_messages = last_bot_messages_group
            deleted_sticker_count = deleted_sticker_count_group

        # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Ç–∏–∫–µ—Ä–æ–º
        bot.delete_message(message.chat.id, message.message_id)
        time.sleep(0.05)

        # –û–±–Ω–æ–≤–ª—è–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å—Ç–∏–∫–µ—Ä–æ–≤
        user_id = message.from_user.id
        if user_id not in deleted_sticker_count:
            deleted_sticker_count[user_id] = 1
        else:
            deleted_sticker_count[user_id] += 1

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥ –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Ä–æ–≥–∞ –≤ 50 —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å—Ç–∏–∫–µ—Ä–æ–≤
        if deleted_sticker_count[user_id] % 50 == 0:
            message_text = f"–û—Ç {user_name} –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ {deleted_sticker_count[user_id]} —Å—Ç–∏–∫–µ—Ä–æ–≤."
            time.sleep(2)
            bot.send_message(message.chat.id, message_text)

        message_text = f"–ë—ã–ª —É–¥–∞–ª–µ–Ω —Å—Ç–∏–∫–µ—Ä –æ—Ç {user_name}, ({deleted_sticker_count[user_id]} —Ä–∞–∑)"
        time.sleep(0.05)

        if message.chat.id in last_bot_messages:
            # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–µ–ª –≤ –∫–æ–Ω–µ—Ü —Ç–µ–∫—Å—Ç–∞, —á—Ç–æ–±—ã –æ–Ω –æ—Ç–ª–∏—á–∞–ª—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            message_text += " "

            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            bot.edit_message_text(chat_id=message.chat.id, message_id=last_bot_messages[message.chat.id].message_id,
                                  text=message_text)
        else:
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–¥—Å—á–µ—Ç–æ–º
            new_message = bot.send_message(message.chat.id, message_text)
            last_bot_messages[message.chat.id] = new_message
        time.sleep(0.05)


# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –¥–ª—è —Å—Ç–∏–∫–µ—Ä–∞
def check_sticker_conditions(sticker):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç–∏–∫–µ—Ä–∞
    size_condition = sticker.file_size > MAX_STICKER_SIZE

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å—Ç–∏–∫–µ—Ä–∞
    resolution_condition = (sticker.width > MAX_STICKER_RESOLUTION[0] or sticker.height > MAX_STICKER_RESOLUTION[1])

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Å—Ç–∏–∫–µ—Ä–∞
    format_condition = sticker.file_id.startswith("CAACAgIAAxkBAAM")

    return (size_condition + resolution_condition + format_condition) >= 1


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.polling()
